Argumentos recibidos: Namespace(model_type='resnet50', clip_version='ViT-B/16', is_lora_image=True, is_lora_text=True, clip_download_dir='CLIP_DIR', dataroot='/home/aih/jan.boada/project/codes/classification', dataset_selection='matek', fold=0, is_hsv=True, is_hed=True, is_rand_aug=True, is_synth_train=False, is_pooled_fewshot=False, n_classes=15, is_mix_aug=True, use_fp16=True, batch_size=64, batch_size_eval=1, epochs=50, wd=1e-08, lr=0.0001, warmup_epochs=30, min_lr=1e-08, output_dir='/home/aih/jan.boada/project/codes/results/classification/fold0/matek/resnet50', saveckpt_freq=100, seed=22, num_workers=12, dist_url='env://', local_rank=0, log='', wandb_entity='regaz', wandb_project='datadream', wandb_group=None, wandb_key='<your_api_key_here>')
Total rows (matek): 18372
Total rows in (kfold0, train): 11024
Total rows (matek): 18372
Total rows in (kfold0, validation): 3674
Total rows (matek): 18372
Total rows in (kfold0, test): 3674
=> Training starts ...
Validation stats for epoch 0: {'val/loss': 2.171502143971999, 'val/top1': 28.3886771910724, 'val/top5': 91.88894937397932, 'val/f1_macro': 0.048408468636623854, 'val/f1_micro': 0.28388677191072403, 'val/f1_weighted': 0.24267511685083423, 'val/auc_macro': 0.4973534854184611, 'val/auc_weighted': 0.5008913478191144}
Validation stats for epoch 1: {'val/loss': 2.025668190430219, 'val/top1': 36.90800217746325, 'val/top5': 93.4676102340773, 'val/f1_macro': 0.05157627771989514, 'val/f1_micro': 0.36908002177463256, 'val/f1_weighted': 0.2923053950719136, 'val/auc_macro': 0.5178138167204434, 'val/auc_weighted': 0.48445062702083336}
Validation stats for epoch 2: {'val/loss': 3.3394442824611343, 'val/top1': 40.337506804572676, 'val/top5': 89.6842678279804, 'val/f1_macro': 0.05991817370249709, 'val/f1_micro': 0.4033750680457267, 'val/f1_weighted': 0.3199619895397327, 'val/auc_macro': 0.5684969269061596, 'val/auc_weighted': 0.5153118872386095}
Validation stats for epoch 3: {'val/loss': 3.844849355952793, 'val/top1': 26.18399564507349, 'val/top5': 87.26183995645073, 'val/f1_macro': 0.05567900574242733, 'val/f1_micro': 0.2618399564507349, 'val/f1_weighted': 0.23477649041805018, 'val/auc_macro': 0.46367026344743784, 'val/auc_weighted': 0.5212588341537826}
Validation stats for epoch 4: {'val/loss': 4.442838400943032, 'val/top1': 20.60424605334785, 'val/top5': 83.39684267827981, 'val/f1_macro': 0.04197168820556467, 'val/f1_micro': 0.2060424605334785, 'val/f1_weighted': 0.1399461435554475, 'val/auc_macro': 0.4590449580576493, 'val/auc_weighted': 0.48807055869129085}
Validation stats for epoch 5: {'val/loss': 3.4986145318560324, 'val/top1': 20.767555797495916, 'val/top5': 85.32934131736526, 'val/f1_macro': 0.04046119579888532, 'val/f1_micro': 0.20767555797495918, 'val/f1_weighted': 0.12906102054636148, 'val/auc_macro': 0.5271890763525348, 'val/auc_weighted': 0.48773643294018787}
Validation stats for epoch 6: {'val/loss': 3.6870481504586707, 'val/top1': 19.923788786064236, 'val/top5': 84.29504627109418, 'val/f1_macro': 0.03601145509673523, 'val/f1_micro': 0.19923788786064237, 'val/f1_weighted': 0.11930648935517552, 'val/auc_macro': 0.5071452743461164, 'val/auc_weighted': 0.4828562580525614}
Validation stats for epoch 7: {'val/loss': 3.5893125082399124, 'val/top1': 20.195971692977682, 'val/top5': 84.51279259662493, 'val/f1_macro': 0.03335958690512452, 'val/f1_micro': 0.20195971692977682, 'val/f1_weighted': 0.1029053497058243, 'val/auc_macro': 0.4686633085534474, 'val/auc_weighted': 0.45042219770733716}
Validation stats for epoch 8: {'val/loss': 3.131520279088485, 'val/top1': 21.420794774088186, 'val/top5': 87.61567773543821, 'val/f1_macro': 0.041586582463730586, 'val/f1_micro': 0.21420794774088187, 'val/f1_weighted': 0.1499730602724227, 'val/auc_macro': 0.47297477251028064, 'val/auc_weighted': 0.4527059501837613}
Validation stats for epoch 9: {'val/loss': 3.1849073597965645, 'val/top1': 22.672836145890038, 'val/top5': 83.2063146434404, 'val/f1_macro': 0.041205379423606275, 'val/f1_micro': 0.22672836145890038, 'val/f1_weighted': 0.1686924218838183, 'val/auc_macro': 0.474165093130725, 'val/auc_weighted': 0.46821055266425093}
Validation stats for epoch 10: {'val/loss': 3.262963840607138, 'val/top1': 21.720195971692977, 'val/top5': 86.47250952640174, 'val/f1_macro': 0.041832421687773104, 'val/f1_micro': 0.21720195971692977, 'val/f1_weighted': 0.16230341570895657, 'val/auc_macro': 0.47105730177115845, 'val/auc_weighted': 0.43790929699202086}
Validation stats for epoch 11: {'val/loss': 3.6038143052052853, 'val/top1': 15.868263473053892, 'val/top5': 76.67392487751769, 'val/f1_macro': 0.0301260008346251, 'val/f1_micro': 0.15868263473053892, 'val/f1_weighted': 0.10805425201113711, 'val/auc_macro': 0.4795437972724129, 'val/auc_weighted': 0.46323231893979033}
Validation stats for epoch 12: {'val/loss': 3.188102693095698, 'val/top1': 24.82308111050626, 'val/top5': 77.57212847033206, 'val/f1_macro': 0.05610201373806431, 'val/f1_micro': 0.2482308111050626, 'val/f1_weighted': 0.24959750916903783, 'val/auc_macro': 0.5049889436202295, 'val/auc_weighted': 0.4142184718929606}
Validation stats for epoch 13: {'val/loss': 3.290200920291874, 'val/top1': 16.494284158954816, 'val/top5': 77.68100163309744, 'val/f1_macro': 0.036369023903224766, 'val/f1_micro': 0.16303756124115407, 'val/f1_weighted': 0.14550670638673963, 'val/auc_macro': 0.49890421106986477, 'val/auc_weighted': 0.4314092446294464}
Validation stats for epoch 14: {'val/loss': 3.07178855734022, 'val/top1': 26.510615133369626, 'val/top5': 75.12248230811105, 'val/f1_macro': 0.03956493236266479, 'val/f1_micro': 0.26510615133369625, 'val/f1_weighted': 0.2301054767629336, 'val/auc_macro': 0.4698324321494448, 'val/auc_weighted': 0.38665896204908956}
Validation stats for epoch 15: {'val/loss': 2.6963482204181837, 'val/top1': 34.21339139902014, 'val/top5': 78.41589548176374, 'val/f1_macro': 0.0520973508600872, 'val/f1_micro': 0.34213391399020143, 'val/f1_weighted': 0.2846554391436423, 'val/auc_macro': 0.45220775941641406, 'val/auc_weighted': 0.4172587459384253}
Validation stats for epoch 16: {'val/loss': 3.691297617566021, 'val/top1': 5.824714207947741, 'val/top5': 74.52367991290147, 'val/f1_macro': 0.019342181689022346, 'val/f1_micro': 0.058519324986390855, 'val/f1_weighted': 0.05378953770317443, 'val/auc_macro': 0.4224545251880476, 'val/auc_weighted': 0.41964515355507015}
Validation stats for epoch 17: {'val/loss': 3.8180364053665974, 'val/top1': 26.59227000544366, 'val/top5': 76.64670658682634, 'val/f1_macro': 0.04696112719104752, 'val/f1_micro': 0.2659227000544366, 'val/f1_weighted': 0.2654310383946691, 'val/auc_macro': 0.4250227057953885, 'val/auc_weighted': 0.42080465754480023}
Validation stats for epoch 18: {'val/loss': 2.779834130566991, 'val/top1': 12.874251497005988, 'val/top5': 80.86554164398476, 'val/f1_macro': 0.0348304232095545, 'val/f1_micro': 0.12874251497005987, 'val/f1_weighted': 0.16686466359859567, 'val/auc_macro': 0.4923063540735725, 'val/auc_weighted': 0.48628194161672544}
Validation stats for epoch 19: {'val/loss': 2.8504977903745066, 'val/top1': 13.41861731083288, 'val/top5': 80.48448557430594, 'val/f1_macro': 0.03413626752067131, 'val/f1_micro': 0.1341861731083288, 'val/f1_weighted': 0.1803162899252654, 'val/auc_macro': 0.45466317334495887, 'val/auc_weighted': 0.4868581392906211}
Validation stats for epoch 20: {'val/loss': 2.6941414689264938, 'val/top1': 25.340228633641807, 'val/top5': 80.43004899292325, 'val/f1_macro': 0.0459677950102927, 'val/f1_micro': 0.2534022863364181, 'val/f1_weighted': 0.27135324963473123, 'val/auc_macro': 0.5154899424295992, 'val/auc_weighted': 0.5245078412408242}
Validation stats for epoch 21: {'val/loss': 3.02137285376867, 'val/top1': 7.348938486663037, 'val/top5': 79.58628198149157, 'val/f1_macro': 0.02381947189371055, 'val/f1_micro': 0.07348938486663037, 'val/f1_weighted': 0.10513928718530309, 'val/auc_macro': 0.44222127438663283, 'val/auc_weighted': 0.4833678014504085}
Validation stats for epoch 22: {'val/loss': 2.445201219653201, 'val/top1': 36.33641807294502, 'val/top5': 78.03483941208492, 'val/f1_macro': 0.05116436602830426, 'val/f1_micro': 0.3633641807294502, 'val/f1_weighted': 0.30767380989205245, 'val/auc_macro': 0.4642806076728262, 'val/auc_weighted': 0.544878019081504}
Validation stats for epoch 23: {'val/loss': 2.8412184447909934, 'val/top1': 33.20631464344039, 'val/top5': 77.59934676102341, 'val/f1_macro': 0.06926067768271377, 'val/f1_micro': 0.33206314643440393, 'val/f1_weighted': 0.35448845399294654, 'val/auc_macro': 0.45209175700369947, 'val/auc_weighted': 0.5293503863490948}
Validation stats for epoch 24: {'val/loss': 2.6386032893596685, 'val/top1': 19.978225367446925, 'val/top5': 78.66086009798585, 'val/f1_macro': 0.04489040920017366, 'val/f1_micro': 0.19978225367446925, 'val/f1_weighted': 0.2679377672991089, 'val/auc_macro': 0.49589350604565374, 'val/auc_weighted': 0.5627370602054321}
Validation stats for epoch 25: {'val/loss': 4.753129288367623, 'val/top1': 7.294501905280349, 'val/top5': 72.91780076211214, 'val/f1_macro': 0.022232116368125023, 'val/f1_micro': 0.07294501905280348, 'val/f1_weighted': 0.11900437724773769, 'val/auc_macro': 0.45231729803414916, 'val/auc_weighted': 0.5588361436262816}
Validation stats for epoch 26: {'val/loss': 2.9800099065009187, 'val/top1': 14.561785519869352, 'val/top5': 79.99455634186172, 'val/f1_macro': 0.042007457692692866, 'val/f1_micro': 0.14534567229178008, 'val/f1_weighted': 0.219374272800435, 'val/auc_macro': 0.44996332711369674, 'val/auc_weighted': 0.5532741182543313}
Validation stats for epoch 27: {'val/loss': 3.797686275088664, 'val/top1': 3.157321720195972, 'val/top5': 76.83723462166576, 'val/f1_macro': 0.014607708997714876, 'val/f1_micro': 0.031573217201959713, 'val/f1_weighted': 0.056892229585255964, 'val/auc_macro': 0.4852576205346379, 'val/auc_weighted': 0.5252640680169994}
Validation stats for epoch 28: {'val/loss': 3.0858424378272042, 'val/top1': 34.81219379422972, 'val/top5': 77.38160043549266, 'val/f1_macro': 0.05227702334673342, 'val/f1_micro': 0.34812193794229723, 'val/f1_weighted': 0.3096068881857854, 'val/auc_macro': 0.4572930011437845, 'val/auc_weighted': 0.5557045003340123}
Validation stats for epoch 29: {'val/loss': 2.5171357613253607, 'val/top1': 16.521502449646164, 'val/top5': 84.34948285247687, 'val/f1_macro': 0.04465480828642384, 'val/f1_micro': 0.16494284158954817, 'val/f1_weighted': 0.21932183139019634, 'val/auc_macro': 0.4821604299495185, 'val/auc_weighted': 0.5388942864140783}
Validation stats for epoch 30: {'val/loss': 4.256382979383661, 'val/top1': 9.49918345127926, 'val/top5': 76.1295590636908, 'val/f1_macro': 0.028293678798592358, 'val/f1_micro': 0.0949918345127926, 'val/f1_weighted': 0.15317693513851396, 'val/auc_macro': 0.4800681998054323, 'val/auc_weighted': 0.5729862875037668}
Validation stats for epoch 31: {'val/loss': 2.867343083891975, 'val/top1': 41.045182362547635, 'val/top5': 79.66793685356559, 'val/f1_macro': 0.07125663085100369, 'val/f1_micro': 0.41045182362547633, 'val/f1_weighted': 0.39511681482880784, 'val/auc_macro': 0.5277260594638656, 'val/auc_weighted': 0.6310670861112522}
Validation stats for epoch 32: {'val/loss': 2.18770787089041, 'val/top1': 43.82144801306478, 'val/top5': 79.28688078388677, 'val/f1_macro': 0.07480588543428743, 'val/f1_micro': 0.4382144801306478, 'val/f1_weighted': 0.39549918224887903, 'val/auc_macro': 0.5271135951880016, 'val/auc_weighted': 0.6348777929025204}
Validation stats for epoch 33: {'val/loss': 2.8195009517098617, 'val/top1': 29.885683179096354, 'val/top5': 77.89874795862819, 'val/f1_macro': 0.07344646666609776, 'val/f1_micro': 0.2988568317909635, 'val/f1_weighted': 0.36971684664828114, 'val/auc_macro': 0.5043363025226617, 'val/auc_weighted': 0.630861965368977}
Validation stats for epoch 34: {'val/loss': 3.7705802772119115, 'val/top1': 9.907457811649428, 'val/top5': 78.00762112139358, 'val/f1_macro': 0.036522590417706884, 'val/f1_micro': 0.09907457811649428, 'val/f1_weighted': 0.1514183182734593, 'val/auc_macro': 0.48816931541708464, 'val/auc_weighted': 0.5835891050969909}
Validation stats for epoch 35: {'val/loss': 3.206256360286075, 'val/top1': 34.56722917800762, 'val/top5': 74.65977136635819, 'val/f1_macro': 0.0864041613153553, 'val/f1_micro': 0.3456722917800762, 'val/f1_weighted': 0.4068280676964276, 'val/auc_macro': 0.5079092350388422, 'val/auc_weighted': 0.6373281714359884}
Validation stats for epoch 36: {'val/loss': 2.744569474221833, 'val/top1': 24.387588459444746, 'val/top5': 79.28688078388677, 'val/f1_macro': 0.06944929501713076, 'val/f1_micro': 0.24387588459444748, 'val/f1_weighted': 0.34831489308082936, 'val/auc_macro': 0.5580453068764925, 'val/auc_weighted': 0.6389514144389856}
Validation stats for epoch 37: {'val/loss': 2.94957409206135, 'val/top1': 27.24550898203593, 'val/top5': 76.3745236799129, 'val/f1_macro': 0.07702442766564081, 'val/f1_micro': 0.27245508982035926, 'val/f1_weighted': 0.36102765447213164, 'val/auc_macro': 0.5402175750715219, 'val/auc_weighted': 0.6333972420021791}
Validation stats for epoch 38: {'val/loss': 2.866375198945703, 'val/top1': 18.69896570495373, 'val/top5': 78.1437125748503, 'val/f1_macro': 0.06141861234767367, 'val/f1_micro': 0.1869896570495373, 'val/f1_weighted': 0.2745502891228725, 'val/auc_macro': 0.5335186382778779, 'val/auc_weighted': 0.630187710776034}
Validation stats for epoch 39: {'val/loss': 3.0500631524482107, 'val/top1': 14.67065868263473, 'val/top5': 77.95318454001088, 'val/f1_macro': 0.042161447504502, 'val/f1_micro': 0.1467065868263473, 'val/f1_weighted': 0.23122565837791542, 'val/auc_macro': 0.5052315784567054, 'val/auc_weighted': 0.6072650984085926}
Validation stats for epoch 40: {'val/loss': 2.8964693799379666, 'val/top1': 22.509526401741972, 'val/top5': 77.408818726184, 'val/f1_macro': 0.06344163091249606, 'val/f1_micro': 0.2250952640174197, 'val/f1_weighted': 0.3189091571427843, 'val/auc_macro': 0.5435122491559994, 'val/auc_weighted': 0.6494090363570985}
Validation stats for epoch 41: {'val/loss': 2.853203019176934, 'val/top1': 24.387588459444746, 'val/top5': 78.79695155144258, 'val/f1_macro': 0.08080203176553481, 'val/f1_micro': 0.24387588459444748, 'val/f1_weighted': 0.3386534424622915, 'val/auc_macro': 0.6018071114091537, 'val/auc_weighted': 0.6750848422412815}
Validation stats for epoch 42: {'val/loss': 2.4406713397203093, 'val/top1': 27.08219923788786, 'val/top5': 79.31409907457811, 'val/f1_macro': 0.09135729116545938, 'val/f1_micro': 0.2708219923788786, 'val/f1_weighted': 0.36984485096174113, 'val/auc_macro': 0.6092297462802313, 'val/auc_weighted': 0.7060776378155451}
Validation stats for epoch 43: {'val/loss': 3.1313165418791526, 'val/top1': 23.57103973870441, 'val/top5': 78.85138813282526, 'val/f1_macro': 0.08051971197502789, 'val/f1_micro': 0.2357103973870441, 'val/f1_weighted': 0.3357443497728538, 'val/auc_macro': 0.5842673921529413, 'val/auc_weighted': 0.6933298869060562}
Validation stats for epoch 44: {'val/loss': 2.5326181762427433, 'val/top1': 28.470332063146433, 'val/top5': 81.05606967882417, 'val/f1_macro': 0.0851320508894326, 'val/f1_micro': 0.28470332063146436, 'val/f1_weighted': 0.3830251627851412, 'val/auc_macro': 0.5570252919455847, 'val/auc_weighted': 0.6867845790728748}
Validation stats for epoch 45: {'val/loss': 2.7290976186387876, 'val/top1': 20.195971692977682, 'val/top5': 80.18508437670114, 'val/f1_macro': 0.06565643972648698, 'val/f1_micro': 0.20195971692977682, 'val/f1_weighted': 0.3024213075271676, 'val/auc_macro': 0.6000428815534942, 'val/auc_weighted': 0.6846061626452699}
Validation stats for epoch 46: {'val/loss': 2.729356392999025, 'val/top1': 23.489384866630374, 'val/top5': 81.54599891126837, 'val/f1_macro': 0.06833979411206022, 'val/f1_micro': 0.23489384866630375, 'val/f1_weighted': 0.3343492967329278, 'val/auc_macro': 0.5748323911840207, 'val/auc_weighted': 0.690952464427097}
Validation stats for epoch 47: {'val/loss': 2.922846360899666, 'val/top1': 18.753402286336417, 'val/top5': 80.21230266739249, 'val/f1_macro': 0.06351522742875337, 'val/f1_micro': 0.18753402286336418, 'val/f1_weighted': 0.28749919974569665, 'val/auc_macro': 0.6024186087959007, 'val/auc_weighted': 0.6900664097346072}
Validation stats for epoch 48: {'val/loss': 3.12449402204336, 'val/top1': 17.011431682090365, 'val/top5': 78.96026129559064, 'val/f1_macro': 0.06467471677358944, 'val/f1_micro': 0.17011431682090364, 'val/f1_weighted': 0.2631738124700317, 'val/auc_macro': 0.6193718006958143, 'val/auc_weighted': 0.6739391047988057}
Validation stats for epoch 49: {'val/loss': 2.565490199355373, 'val/top1': 24.686989657049537, 'val/top5': 80.86554164398476, 'val/f1_macro': 0.0820832133699603, 'val/f1_micro': 0.24686989657049538, 'val/f1_weighted': 0.34228959756428723, 'val/auc_macro': 0.5952682058911597, 'val/auc_weighted': 0.6855972169711539}
=> Evaluating on test set...
Test images: 3674
Test Confusion Matrix:
[[  0   0   0   9   0   0   0   0   3   0   0   0   2   0   1]
 [  0   1   0   6   0   1   0   0   1   0   0   0   4   0   3]
 [  0   0   0  74   0   0   0   0   6   0   0   0   2   0   3]
 [  0   0   0   2   0   0   0   0   1   0   0   0   0   0   1]
 [  0   0   0   2   0   0   0   0   1   0   0   0   0   0   0]
 [  0  22   0 426   0 155   0   0  31   0   6   0 100   0  47]
 [  0   0   0   2   0   0   0   0   0   0   1   0   0   0   0]
 [  0   0   0   5   0   0   0   0   0   0   0   0   0   0   0]
 [  0   1   0 299   0  14   0   0  24   0   3   0   3   0  14]
 [  0   0   0   5   0   1   0   0   2   0   0   0   0   0   0]
 [  0   2   0 504   0  31   0   0  61   0   8   0  12   0  36]
 [  0   0   0  17   0   1   0   0   1   0   0   0   3   0   0]
 [  0   0   0 990   0  40   0   0  50   0  17   0 524   0  75]
 [  0   0   0   3   0   0   0   0   1   0   0   0   0   0   0]
 [  0   0   0  11   0   1   0   0   2   0   0   0   0   0   0]]
Basophil [0]: 0.0
Erythroblast [1]: 6.25
Eosinophil [2]: 0.0
Smudge cell [3]: 50.0
Atypical Lymphocyte [4]: 0.0
Typical Lymphocyte [5]: 19.695043563842773
Metamyelocyte [6]: 0.0
Monoblast [7]: 0.0
Monocyte [8]: 6.703910827636719
Myelocyte [9]: 0.0
Myeloblast [10]: 1.2232415676116943
Band Neutrophil [11]: 0.0
Segmented Neutrophil [12]: 30.89622688293457
Promyelocyte Bilobed [13]: 0.0
Promyelocyte [14]: 0.0
Test stats: {'test/loss': 2.7727478808141885, 'test/top1': 19.43385955362003, 'test/top5': 80.9471965160588, 'test/f1_macro': 0.06056629319760396, 'test/f1_micro': 0.19433859553620034, 'test/f1_weighted': 0.28359511877862126, 'test/auc_macro': 0.5493417922976586, 'test/auc_weighted': 0.6549895065422}
Fin del script.
