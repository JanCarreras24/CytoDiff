Argumentos recibidos: Namespace(model_type='resnet50', clip_version='ViT-B/16', is_lora_image=True, is_lora_text=True, clip_download_dir='CLIP_DIR', dataroot='/home/aih/jan.boada/project/codes/classification', dataset_selection='matek', fold=1, is_hsv=True, is_hed=True, is_rand_aug=True, is_synth_train=False, is_pooled_fewshot=False, n_classes=15, is_mix_aug=True, use_fp16=True, batch_size=64, batch_size_eval=1, epochs=50, wd=1e-08, lr=0.0001, warmup_epochs=30, min_lr=1e-08, output_dir='/home/aih/jan.boada/project/codes/results/classification/fold1/matek/resnet50', saveckpt_freq=100, seed=22, num_workers=12, dist_url='env://', local_rank=0, log='', wandb_entity='regaz', wandb_project='datadream', wandb_group=None, wandb_key='<your_api_key_here>')
Total rows (matek): 18372
Total rows in (kfold1, train): 11023
Total rows (matek): 18372
Total rows in (kfold1, validation): 3674
Total rows (matek): 18372
Total rows in (kfold1, test): 3675
=> Training starts ...
Validation stats for epoch 0: {'val/loss': 2.132739603357206, 'val/top1': 24.1154055525313, 'val/top5': 94.09363091997822, 'val/f1_macro': 0.05219548691084681, 'val/f1_micro': 0.24115405552531302, 'val/f1_weighted': 0.2109277056667747, 'val/auc_macro': 0.4965904857627066, 'val/auc_weighted': 0.5032215370406244}
Validation stats for epoch 1: {'val/loss': 2.2634769911083374, 'val/top1': 36.74469243331519, 'val/top5': 92.9776810016331, 'val/f1_macro': 0.05137750703105729, 'val/f1_micro': 0.3674469243331519, 'val/f1_weighted': 0.2925457008543637, 'val/auc_macro': 0.49682036848901967, 'val/auc_weighted': 0.48705965624453856}
Validation stats for epoch 2: {'val/loss': 3.6058692864639705, 'val/top1': 40.28307022318998, 'val/top5': 89.30321175830157, 'val/f1_macro': 0.05193388591789658, 'val/f1_micro': 0.4028307022318998, 'val/f1_weighted': 0.3042945486960854, 'val/auc_macro': 0.5600723159435302, 'val/auc_weighted': 0.5141297314588913}
Validation stats for epoch 3: {'val/loss': 3.483097629113631, 'val/top1': 28.307022318998367, 'val/top5': 88.51388132825258, 'val/f1_macro': 0.05957760428041845, 'val/f1_micro': 0.28307022318998365, 'val/f1_weighted': 0.26413504715698904, 'val/auc_macro': 0.5066911596218379, 'val/auc_weighted': 0.5177590457677796}
Validation stats for epoch 4: {'val/loss': 4.089799651518164, 'val/top1': 21.284703320631465, 'val/top5': 85.05715841045182, 'val/f1_macro': 0.04327370290939334, 'val/f1_micro': 0.21284703320631465, 'val/f1_weighted': 0.15673634734515843, 'val/auc_macro': 0.4947920485416542, 'val/auc_weighted': 0.5006854366798285}
Validation stats for epoch 5: {'val/loss': 4.241512064059013, 'val/top1': 20.059880239520957, 'val/top5': 85.11159499183451, 'val/f1_macro': 0.04006431715132265, 'val/f1_micro': 0.20059880239520958, 'val/f1_weighted': 0.11663580296200284, 'val/auc_macro': 0.526078040354781, 'val/auc_weighted': 0.4684538528103537}
Validation stats for epoch 6: {'val/loss': 3.012721502462936, 'val/top1': 22.80892759934676, 'val/top5': 87.83342406096897, 'val/f1_macro': 0.04628324472703824, 'val/f1_micro': 0.22808927599346762, 'val/f1_weighted': 0.1877009459557024, 'val/auc_macro': 0.4940386245044461, 'val/auc_weighted': 0.45705546865212854}
Validation stats for epoch 7: {'val/loss': 3.26053096914525, 'val/top1': 25.93903102885139, 'val/top5': 87.56124115405552, 'val/f1_macro': 0.04943817092628347, 'val/f1_micro': 0.2593903102885139, 'val/f1_weighted': 0.2444096762682085, 'val/auc_macro': 0.4520473843130123, 'val/auc_weighted': 0.4360733243559579}
Validation stats for epoch 8: {'val/loss': 3.226462757191583, 'val/top1': 22.536744692433317, 'val/top5': 87.94229722373434, 'val/f1_macro': 0.0474087289824134, 'val/f1_micro': 0.22536744692433316, 'val/f1_weighted': 0.19879074915905484, 'val/auc_macro': 0.4506637096116389, 'val/auc_weighted': 0.4688587183750676}
Validation stats for epoch 9: {'val/loss': 2.9293624553981528, 'val/top1': 20.985302123026674, 'val/top5': 89.38486663037561, 'val/f1_macro': 0.039263290618084506, 'val/f1_micro': 0.20985302123026675, 'val/f1_weighted': 0.153948860458375, 'val/auc_macro': 0.46072863602053654, 'val/auc_weighted': 0.44721909352545736}
Validation stats for epoch 10: {'val/loss': 2.6901929229254558, 'val/top1': 29.531845400108875, 'val/top5': 88.29613500272183, 'val/f1_macro': 0.0508326678836367, 'val/f1_micro': 0.29531845400108875, 'val/f1_weighted': 0.2644913984528773, 'val/auc_macro': 0.45879332925328786, 'val/auc_weighted': 0.4296077975658229}
Validation stats for epoch 11: {'val/loss': 3.678788718284312, 'val/top1': 36.52694610778443, 'val/top5': 87.01687534022864, 'val/f1_macro': 0.05010422422760086, 'val/f1_micro': 0.3652694610778443, 'val/f1_weighted': 0.28854691474407723, 'val/auc_macro': 0.48469704712204215, 'val/auc_weighted': 0.4423734073359291}
Validation stats for epoch 12: {'val/loss': 3.8536236231652823, 'val/top1': 16.03157321720196, 'val/top5': 89.11268372346217, 'val/f1_macro': 0.04318787336660625, 'val/f1_micro': 0.16004354926510614, 'val/f1_weighted': 0.1784561232357728, 'val/auc_macro': 0.4682314969227296, 'val/auc_weighted': 0.4473805126383281}
Validation stats for epoch 13: {'val/loss': 3.1854160663934916, 'val/top1': 26.53783342406097, 'val/top5': 86.85356559608057, 'val/f1_macro': 0.050909829870558115, 'val/f1_micro': 0.2653783342406097, 'val/f1_weighted': 0.2506844408097158, 'val/auc_macro': 0.49632802272254717, 'val/auc_weighted': 0.43894202013272543}
Validation stats for epoch 14: {'val/loss': 2.940456998821958, 'val/top1': 34.78497550353838, 'val/top5': 90.4735982580294, 'val/f1_macro': 0.04202910412395966, 'val/f1_micro': 0.3478497550353838, 'val/f1_weighted': 0.25932276159681195, 'val/auc_macro': 0.4397447247875025, 'val/auc_weighted': 0.4218965539353436}
Validation stats for epoch 15: {'val/loss': 2.699819399730369, 'val/top1': 33.26075122482308, 'val/top5': 91.88894937397932, 'val/f1_macro': 0.056559662960375595, 'val/f1_micro': 0.3326075122482308, 'val/f1_weighted': 0.2964702012988924, 'val/auc_macro': 0.4781838201466174, 'val/auc_weighted': 0.4359684733495326}
Validation stats for epoch 16: {'val/loss': 3.0373201925078357, 'val/top1': 33.04300489929233, 'val/top5': 92.54218835057158, 'val/f1_macro': 0.04586350188004358, 'val/f1_micro': 0.3304300489929232, 'val/f1_weighted': 0.2677333869142063, 'val/auc_macro': 0.4275230163493797, 'val/auc_weighted': 0.4291173746797192}
Validation stats for epoch 17: {'val/loss': 3.1230898905397435, 'val/top1': 20.631464344039195, 'val/top5': 88.62275449101796, 'val/f1_macro': 0.03748189185753452, 'val/f1_micro': 0.20631464344039194, 'val/f1_weighted': 0.1435145069961143, 'val/auc_macro': 0.43983683332350537, 'val/auc_weighted': 0.4687766656922529}
Validation stats for epoch 18: {'val/loss': 2.4054717436132704, 'val/top1': 30.239520958083833, 'val/top5': 92.86880783886772, 'val/f1_macro': 0.05438601668120362, 'val/f1_micro': 0.3023952095808383, 'val/f1_weighted': 0.3048459926563621, 'val/auc_macro': 0.45266888189246884, 'val/auc_weighted': 0.4965778896438808}
Validation stats for epoch 19: {'val/loss': 2.643903621202198, 'val/top1': 37.724550898203596, 'val/top5': 92.62384322264562, 'val/f1_macro': 0.04936030848409107, 'val/f1_micro': 0.3772455089820359, 'val/f1_weighted': 0.29514628832682605, 'val/auc_macro': 0.4290402221010709, 'val/auc_weighted': 0.4519770792155886}
Validation stats for epoch 20: {'val/loss': 2.666306143165219, 'val/top1': 37.69733260751225, 'val/top5': 81.60043549265106, 'val/f1_macro': 0.06351227789083727, 'val/f1_micro': 0.37697332607512246, 'val/f1_weighted': 0.33428603823798986, 'val/auc_macro': 0.47290862108058024, 'val/auc_weighted': 0.5153848520555467}
Validation stats for epoch 21: {'val/loss': 2.6270725040508474, 'val/top1': 40.337506804572676, 'val/top5': 79.34131736526946, 'val/f1_macro': 0.05458228631179688, 'val/f1_micro': 0.4033750680457267, 'val/f1_weighted': 0.3182264383077527, 'val/auc_macro': 0.4674709014927841, 'val/auc_weighted': 0.46797433240357517}
Validation stats for epoch 22: {'val/loss': 2.573102059154064, 'val/top1': 26.320087098530212, 'val/top5': 80.70223189983669, 'val/f1_macro': 0.05363395776054901, 'val/f1_micro': 0.26320087098530215, 'val/f1_weighted': 0.23406734021085637, 'val/auc_macro': 0.47174449508994065, 'val/auc_weighted': 0.5282487601656335}
Validation stats for epoch 23: {'val/loss': 3.5580175791217634, 'val/top1': 36.58138268916712, 'val/top5': 81.89983669025585, 'val/f1_macro': 0.057259152504053334, 'val/f1_micro': 0.3658138268916712, 'val/f1_weighted': 0.3158719000963385, 'val/auc_macro': 0.4567260217733167, 'val/auc_weighted': 0.5192898722771402}
Validation stats for epoch 24: {'val/loss': 2.546451309029668, 'val/top1': 35.24768644529124, 'val/top5': 77.6537833424061, 'val/f1_macro': 0.06616810752623588, 'val/f1_micro': 0.3524768644529124, 'val/f1_weighted': 0.33432339771362435, 'val/auc_macro': 0.48756560501085316, 'val/auc_weighted': 0.5905954379784462}
Validation stats for epoch 25: {'val/loss': 2.6729925048695224, 'val/top1': 31.05606967882417, 'val/top5': 79.01469787697333, 'val/f1_macro': 0.06383533774214772, 'val/f1_micro': 0.3102885138813283, 'val/f1_weighted': 0.30973719950154655, 'val/auc_macro': 0.4381252740215922, 'val/auc_weighted': 0.6105750156107413}
Validation stats for epoch 26: {'val/loss': 2.346074087177208, 'val/top1': 42.62384322264562, 'val/top5': 79.6135002721829, 'val/f1_macro': 0.05711663449228686, 'val/f1_micro': 0.4262384322264562, 'val/f1_weighted': 0.33076385082303494, 'val/auc_macro': 0.46708961445849834, 'val/auc_weighted': 0.5762554371933714}
Validation stats for epoch 27: {'val/loss': 2.737285986567037, 'val/top1': 33.04300489929233, 'val/top5': 85.43821448013065, 'val/f1_macro': 0.06867152090694026, 'val/f1_micro': 0.3304300489929232, 'val/f1_weighted': 0.3368693940474185, 'val/auc_macro': 0.521852195113242, 'val/auc_weighted': 0.5881006639852178}
Validation stats for epoch 28: {'val/loss': 2.848236216886185, 'val/top1': 35.46543277082199, 'val/top5': 78.41589548176374, 'val/f1_macro': 0.06711411861288777, 'val/f1_micro': 0.3546543277082199, 'val/f1_weighted': 0.3424291066447625, 'val/auc_macro': 0.4176889532366688, 'val/auc_weighted': 0.517506318186197}
Validation stats for epoch 29: {'val/loss': 2.238010811429343, 'val/top1': 41.91616766467066, 'val/top5': 80.81110506260207, 'val/f1_macro': 0.06742366346328679, 'val/f1_micro': 0.41916167664670656, 'val/f1_weighted': 0.34762776088840824, 'val/auc_macro': 0.5143249875313098, 'val/auc_weighted': 0.588583513195528}
Validation stats for epoch 30: {'val/loss': 3.0681866077086686, 'val/top1': 35.19324986390855, 'val/top5': 80.51170386499727, 'val/f1_macro': 0.06032815036757439, 'val/f1_micro': 0.35220468154599893, 'val/f1_weighted': 0.330810466779828, 'val/auc_macro': 0.5025843736808866, 'val/auc_weighted': 0.5945974196336934}
Validation stats for epoch 31: {'val/loss': 3.081301853880002, 'val/top1': 43.98475775721285, 'val/top5': 78.52476864452912, 'val/f1_macro': 0.07556127670373988, 'val/f1_micro': 0.43984757757212845, 'val/f1_weighted': 0.39093885045720994, 'val/auc_macro': 0.5333981579264294, 'val/auc_weighted': 0.6460874476037319}
Validation stats for epoch 32: {'val/loss': 2.471343240338171, 'val/top1': 36.82634730538922, 'val/top5': 79.39575394665215, 'val/f1_macro': 0.05983762345922012, 'val/f1_micro': 0.36826347305389223, 'val/f1_weighted': 0.3370033328119225, 'val/auc_macro': 0.4916722447670819, 'val/auc_weighted': 0.625078452759374}
Validation stats for epoch 33: {'val/loss': 2.889203191517356, 'val/top1': 25.966249319542733, 'val/top5': 77.78987479586281, 'val/f1_macro': 0.051065646016400366, 'val/f1_micro': 0.25966249319542734, 'val/f1_weighted': 0.3037209599527986, 'val/auc_macro': 0.4508599690970019, 'val/auc_weighted': 0.5708454129412754}
Validation stats for epoch 34: {'val/loss': 3.1556881908236085, 'val/top1': 21.992378878606424, 'val/top5': 80.04899292324443, 'val/f1_macro': 0.05536995760400824, 'val/f1_micro': 0.21992378878606422, 'val/f1_weighted': 0.28281608579420403, 'val/auc_macro': 0.5001210825806469, 'val/auc_weighted': 0.581102518698241}
Validation stats for epoch 35: {'val/loss': 2.617127587760215, 'val/top1': 43.9575394665215, 'val/top5': 79.45019052803484, 'val/f1_macro': 0.08722647245746877, 'val/f1_micro': 0.439575394665215, 'val/f1_weighted': 0.43272390643928565, 'val/auc_macro': 0.5034495963809026, 'val/auc_weighted': 0.6176321032595162}
Validation stats for epoch 36: {'val/loss': 2.3539653979505477, 'val/top1': 40.14697876973326, 'val/top5': 81.24659771366358, 'val/f1_macro': 0.08391554008011214, 'val/f1_micro': 0.4014697876973326, 'val/f1_weighted': 0.3953091187055777, 'val/auc_macro': 0.5806155064025256, 'val/auc_weighted': 0.6650071692682537}
Validation stats for epoch 37: {'val/loss': 2.092164381730148, 'val/top1': 40.41916167664671, 'val/top5': 83.53293413173652, 'val/f1_macro': 0.0912261837821829, 'val/f1_micro': 0.4041916167664671, 'val/f1_weighted': 0.41436285552679974, 'val/auc_macro': 0.5354219708060806, 'val/auc_weighted': 0.6156568168319372}
Validation stats for epoch 38: {'val/loss': 2.00088406699341, 'val/top1': 49.64616222101252, 'val/top5': 82.25367446924334, 'val/f1_macro': 0.08087658220520168, 'val/f1_micro': 0.4964616222101252, 'val/f1_weighted': 0.4104708017436341, 'val/auc_macro': 0.6318834716560029, 'val/auc_weighted': 0.737816980751944}
Validation stats for epoch 39: {'val/loss': 2.1985140215396624, 'val/top1': 38.160043549265104, 'val/top5': 81.437125748503, 'val/f1_macro': 0.08266177116531243, 'val/f1_micro': 0.38160043549265105, 'val/f1_weighted': 0.40243648555927164, 'val/auc_macro': 0.5871502235003567, 'val/auc_weighted': 0.6737573981123466}
Validation stats for epoch 40: {'val/loss': 2.6934763472821315, 'val/top1': 43.712574850299404, 'val/top5': 76.1295590636908, 'val/f1_macro': 0.09060672893159148, 'val/f1_micro': 0.437125748502994, 'val/f1_weighted': 0.4346239523620027, 'val/auc_macro': 0.5749415883900386, 'val/auc_weighted': 0.6616830911381123}
Validation stats for epoch 41: {'val/loss': 2.450254960493608, 'val/top1': 37.071311921611326, 'val/top5': 77.51769188894937, 'val/f1_macro': 0.07833613517039902, 'val/f1_micro': 0.3707131192161132, 'val/f1_weighted': 0.40526424837524055, 'val/auc_macro': 0.6014151117918233, 'val/auc_weighted': 0.6811763076229727}
Validation stats for epoch 42: {'val/loss': 2.6419383014228335, 'val/top1': 24.659771366358193, 'val/top5': 77.68100163309744, 'val/f1_macro': 0.06277345408199932, 'val/f1_micro': 0.24659771366358194, 'val/f1_weighted': 0.3251132214420356, 'val/auc_macro': 0.6203291178733028, 'val/auc_weighted': 0.6515361224044479}
Validation stats for epoch 43: {'val/loss': 2.424320899992451, 'val/top1': 35.43821448013065, 'val/top5': 80.21230266739249, 'val/f1_macro': 0.08311345642276656, 'val/f1_micro': 0.35410996189439303, 'val/f1_weighted': 0.4022217698782168, 'val/auc_macro': 0.6135052702512608, 'val/auc_weighted': 0.6920779170271996}
Validation stats for epoch 44: {'val/loss': 1.9884590227836232, 'val/top1': 50.217746325530754, 'val/top5': 81.40990745781166, 'val/f1_macro': 0.10209130927919066, 'val/f1_micro': 0.5021774632553075, 'val/f1_weighted': 0.47457775740618163, 'val/auc_macro': 0.6032089696226016, 'val/auc_weighted': 0.7272007608712919}
Validation stats for epoch 45: {'val/loss': 2.067437468369369, 'val/top1': 39.82035928143713, 'val/top5': 80.78388677191073, 'val/f1_macro': 0.08543147706399863, 'val/f1_micro': 0.39820359281437123, 'val/f1_weighted': 0.4295528195555829, 'val/auc_macro': 0.665858559230621, 'val/auc_weighted': 0.7343662605157876}
Validation stats for epoch 46: {'val/loss': 2.3837190315524843, 'val/top1': 38.26891671203048, 'val/top5': 79.01469787697333, 'val/f1_macro': 0.08746796287490198, 'val/f1_micro': 0.3826891671203048, 'val/f1_weighted': 0.4354859479898092, 'val/auc_macro': 0.6086477963998507, 'val/auc_weighted': 0.7134242186869553}
Validation stats for epoch 47: {'val/loss': 2.313621487770641, 'val/top1': 30.892759934676103, 'val/top5': 79.1780076211214, 'val/f1_macro': 0.07954864284788586, 'val/f1_micro': 0.308927599346761, 'val/f1_weighted': 0.38803697689983513, 'val/auc_macro': 0.6393695353712013, 'val/auc_weighted': 0.7179191269442515}
Validation stats for epoch 48: {'val/loss': 2.314802041051176, 'val/top1': 30.729450190528034, 'val/top5': 79.47740881872619, 'val/f1_macro': 0.07474515236865621, 'val/f1_micro': 0.30729450190528035, 'val/f1_weighted': 0.38016307376111574, 'val/auc_macro': 0.6231292637850356, 'val/auc_weighted': 0.7195542472078262}
Validation stats for epoch 49: {'val/loss': 2.172943837887967, 'val/top1': 42.324442025040824, 'val/top5': 77.73543821448013, 'val/f1_macro': 0.08480332070792182, 'val/f1_micro': 0.42324442025040826, 'val/f1_weighted': 0.4150550571833014, 'val/auc_macro': 0.6484769243886677, 'val/auc_weighted': 0.7172697347549755}
=> Evaluating on test set...
Test images: 3675
Test Confusion Matrix:
[[   0    1    0    2    0    2    0    0    5    0    1    0    4    0    1]
 [   0    1    0    0    0    2    0    0    0    0    0    0    9    0    4]
 [   0    5    0   42    0    4    0    0   17    0    0    0   15    0    2]
 [   0    1    0    1    0    0    0    0    0    0    0    0    0    0    1]
 [   0    0    0    0    0    1    0    0    0    0    0    0    3    0    0]
 [   0  117    0   28    0  244    0    0   41    0   12    0  304    0   42]
 [   0    0    0    0    0    0    0    0    0    0    0    0    3    0    0]
 [   0    1    0    1    0    0    0    0    1    0    0    0    2    0    0]
 [   0   42    0   47    0   74    0    0   54    0    8    0  118    0   15]
 [   0    0    0    2    0    1    0    0    5    0    0    0    1    0    0]
 [   0  111    0   60    0  155    0    0   89    0   15    0  189    0   34]
 [   0    0    0    6    0    5    0    0    0    0    0    0   10    0    0]
 [   0   39    0  120    0  130    0    0   71    0   23    0 1236    0   78]
 [   0    2    0    1    0    0    0    0    0    0    0    0    0    0    0]
 [   0    0    0    3    0    1    0    0    9    0    0    0    1    0    0]]
Basophil [0]: 0.0
Erythroblast [1]: 6.25
Eosinophil [2]: 0.0
Smudge cell [3]: 33.33333206176758
Atypical Lymphocyte [4]: 0.0
Typical Lymphocyte [5]: 30.964466094970703
Metamyelocyte [6]: 0.0
Monoblast [7]: 0.0
Monocyte [8]: 15.0837984085083
Myelocyte [9]: 0.0
Myeloblast [10]: 2.2970902919769287
Band Neutrophil [11]: 0.0
Segmented Neutrophil [12]: 73.01119995117188
Promyelocyte Bilobed [13]: 0.0
Promyelocyte [14]: 0.0
Test stats: {'test/loss': 2.3041632163119155, 'test/top1': 42.204081632653065, 'test/top5': 80.02721088435374, 'test/f1_macro': 0.08370689372945976, 'test/f1_micro': 0.4220408163265306, 'test/f1_weighted': 0.41586059623544386, 'test/auc_macro': 0.5793078884082916, 'test/auc_weighted': 0.6881684804335982}
Fin del script.
