Argumentos recibidos: Namespace(model_type='resnet50', clip_version='ViT-B/16', is_lora_image=True, is_lora_text=True, clip_download_dir='CLIP_DIR', dataroot='/home/aih/jan.boada/project/codes/classification', dataset_selection='matek', fold=2, is_hsv=True, is_hed=True, is_rand_aug=True, is_synth_train=False, is_pooled_fewshot=False, n_classes=15, is_mix_aug=True, use_fp16=True, batch_size=64, batch_size_eval=1, epochs=50, wd=1e-08, lr=0.0001, warmup_epochs=30, min_lr=1e-08, output_dir='/home/aih/jan.boada/project/codes/results/classification/fold2/matek/resnet50', saveckpt_freq=100, seed=22, num_workers=12, dist_url='env://', local_rank=0, log='', wandb_entity='regaz', wandb_project='datadream', wandb_group=None, wandb_key='<your_api_key_here>')
Total rows (matek): 18372
Total rows in (kfold2, train): 11022
Total rows (matek): 18372
Total rows in (kfold2, validation): 3675
Total rows (matek): 18372
Total rows in (kfold2, test): 3675
=> Training starts ...
Validation stats for epoch 0: {'val/loss': 2.1689789275085034, 'val/top1': 29.170068027210885, 'val/top5': 92.68027210884354, 'val/f1_macro': 0.059940530435667834, 'val/f1_micro': 0.291156462585034, 'val/f1_weighted': 0.27569722539342256, 'val/auc_macro': 0.5226748280134007, 'val/auc_weighted': 0.5016128070660961}
Validation stats for epoch 1: {'val/loss': 2.2250198177415497, 'val/top1': 36.21768707482993, 'val/top5': 92.1360544217687, 'val/f1_macro': 0.05182654148234442, 'val/f1_micro': 0.3621768707482993, 'val/f1_weighted': 0.292104240876392, 'val/auc_macro': 0.5088629414642454, 'val/auc_weighted': 0.48326980695863214}
Validation stats for epoch 2: {'val/loss': 2.745788805760494, 'val/top1': 33.795918367346935, 'val/top5': 90.91156462585035, 'val/f1_macro': 0.06643067926734154, 'val/f1_micro': 0.3379591836734694, 'val/f1_weighted': 0.31944657635328844, 'val/auc_macro': 0.5490822406122166, 'val/auc_weighted': 0.5197337123404836}
Validation stats for epoch 3: {'val/loss': 3.9677188421755423, 'val/top1': 23.891156462585034, 'val/top5': 86.72108843537416, 'val/f1_macro': 0.049889836005014634, 'val/f1_micro': 0.23891156462585034, 'val/f1_weighted': 0.19167826033921467, 'val/auc_macro': 0.4919451833212046, 'val/auc_weighted': 0.5116650966451498}
Validation stats for epoch 4: {'val/loss': 4.637956306561321, 'val/top1': 20.163265306122447, 'val/top5': 83.34693877551021, 'val/f1_macro': 0.03758385485655329, 'val/f1_micro': 0.2016326530612245, 'val/f1_weighted': 0.11120509497341247, 'val/auc_macro': 0.4526775548000704, 'val/auc_weighted': 0.503578007019954}
Validation stats for epoch 5: {'val/loss': 4.458019546197385, 'val/top1': 20.435374149659864, 'val/top5': 83.5374149659864, 'val/f1_macro': 0.04097057139929742, 'val/f1_micro': 0.20435374149659863, 'val/f1_weighted': 0.1212035667971694, 'val/auc_macro': 0.5233050453612393, 'val/auc_weighted': 0.4822107948377503}
Validation stats for epoch 6: {'val/loss': 3.9295590230721196, 'val/top1': 21.46938775510204, 'val/top5': 84.95238095238095, 'val/f1_macro': 0.03940667394895014, 'val/f1_micro': 0.2146938775510204, 'val/f1_weighted': 0.14566933507769259, 'val/auc_macro': 0.4874368503936779, 'val/auc_weighted': 0.47465066779936266}
Validation stats for epoch 7: {'val/loss': 3.37972473767339, 'val/top1': 19.891156462585034, 'val/top5': 86.85714285714286, 'val/f1_macro': 0.03623604985176006, 'val/f1_micro': 0.19891156462585033, 'val/f1_weighted': 0.1140809745534705, 'val/auc_macro': 0.44473305688327996, 'val/auc_weighted': 0.4578824655601679}
Validation stats for epoch 8: {'val/loss': 3.331545435587565, 'val/top1': 22.93877551020408, 'val/top5': 84.19047619047619, 'val/f1_macro': 0.043977630789480984, 'val/f1_micro': 0.22938775510204082, 'val/f1_weighted': 0.16497343551909024, 'val/auc_macro': 0.4401191225904143, 'val/auc_weighted': 0.4830149635272672}
Validation stats for epoch 9: {'val/loss': 2.965255899234694, 'val/top1': 21.85034013605442, 'val/top5': 86.25850340136054, 'val/f1_macro': 0.04266532602660019, 'val/f1_micro': 0.21850340136054422, 'val/f1_weighted': 0.16722525435434035, 'val/auc_macro': 0.48055828695044756, 'val/auc_weighted': 0.4643830021714334}
Validation stats for epoch 10: {'val/loss': 3.5331019145939626, 'val/top1': 33.06122448979592, 'val/top5': 86.20408163265306, 'val/f1_macro': 0.0446387298320521, 'val/f1_micro': 0.3306122448979592, 'val/f1_weighted': 0.26276913789673323, 'val/auc_macro': 0.4958171359303642, 'val/auc_weighted': 0.4267879294134752}
Validation stats for epoch 11: {'val/loss': 3.228457765125093, 'val/top1': 30.72108843537415, 'val/top5': 85.9047619047619, 'val/f1_macro': 0.044530227623336055, 'val/f1_micro': 0.3072108843537415, 'val/f1_weighted': 0.2574060032601472, 'val/auc_macro': 0.4848200728573361, 'val/auc_weighted': 0.4516429784798547}
Validation stats for epoch 12: {'val/loss': 3.7701598041560374, 'val/top1': 32.40816326530612, 'val/top5': 86.25850340136054, 'val/f1_macro': 0.042326389812858016, 'val/f1_micro': 0.3240816326530612, 'val/f1_weighted': 0.2547061467029861, 'val/auc_macro': 0.4751099953210325, 'val/auc_weighted': 0.4164806236333163}
Validation stats for epoch 13: {'val/loss': 3.6449152815423043, 'val/top1': 26.8843537414966, 'val/top5': 85.60544217687075, 'val/f1_macro': 0.04976124281032538, 'val/f1_micro': 0.26884353741496597, 'val/f1_weighted': 0.2731485822956649, 'val/auc_macro': 0.46953115831468956, 'val/auc_weighted': 0.45363082033942687}
Validation stats for epoch 14: {'val/loss': 3.140364877090973, 'val/top1': 14.013605442176871, 'val/top5': 88.27210884353741, 'val/f1_macro': 0.028932939524371554, 'val/f1_micro': 0.1401360544217687, 'val/f1_weighted': 0.1726459851784821, 'val/auc_macro': 0.4975473096512573, 'val/auc_weighted': 0.45687343434916144}
Validation stats for epoch 15: {'val/loss': 3.2502156492479806, 'val/top1': 12.89795918367347, 'val/top5': 83.31972789115646, 'val/f1_macro': 0.03772274455078626, 'val/f1_micro': 0.12897959183673469, 'val/f1_weighted': 0.15671564571773228, 'val/auc_macro': 0.44654034155226313, 'val/auc_weighted': 0.4649186848196121}
Validation stats for epoch 16: {'val/loss': 2.621528725137516, 'val/top1': 35.755102040816325, 'val/top5': 92.59863945578232, 'val/f1_macro': 0.05001956127426113, 'val/f1_micro': 0.3575510204081633, 'val/f1_weighted': 0.2922939865597387, 'val/auc_macro': 0.46603791501354025, 'val/auc_weighted': 0.4348855510882501}
Validation stats for epoch 17: {'val/loss': 3.62190607810507, 'val/top1': 8.136054421768707, 'val/top5': 77.27891156462584, 'val/f1_macro': 0.022543279188028273, 'val/f1_micro': 0.08136054421768707, 'val/f1_weighted': 0.12261471588476802, 'val/auc_macro': 0.4442639213661168, 'val/auc_weighted': 0.48565740787381984}
Validation stats for epoch 18: {'val/loss': 2.6292637914540817, 'val/top1': 21.714285714285715, 'val/top5': 84.51700680272108, 'val/f1_macro': 0.0410212615978363, 'val/f1_micro': 0.21687074829931974, 'val/f1_weighted': 0.16008571641342284, 'val/auc_macro': 0.4775248025757898, 'val/auc_weighted': 0.47920686372579324}
Validation stats for epoch 19: {'val/loss': 3.068132241177721, 'val/top1': 9.877551020408163, 'val/top5': 79.34693877551021, 'val/f1_macro': 0.02502156031603649, 'val/f1_micro': 0.09877551020408164, 'val/f1_weighted': 0.08365221779648882, 'val/auc_macro': 0.42039955648697, 'val/auc_weighted': 0.476797287435657}
Validation stats for epoch 20: {'val/loss': 3.1662193604553637, 'val/top1': 20.0, 'val/top5': 81.38775510204081, 'val/f1_macro': 0.04297999110851629, 'val/f1_micro': 0.2, 'val/f1_weighted': 0.23149911498864711, 'val/auc_macro': 0.4711894067930213, 'val/auc_weighted': 0.48289926849629655}
Validation stats for epoch 21: {'val/loss': 3.279240108152636, 'val/top1': 15.29251700680272, 'val/top5': 75.15646258503402, 'val/f1_macro': 0.035141069731386726, 'val/f1_micro': 0.15292517006802722, 'val/f1_weighted': 0.18028880000675776, 'val/auc_macro': 0.48390224251908437, 'val/auc_weighted': 0.4670784675662162}
Validation stats for epoch 22: {'val/loss': 3.1819890900696217, 'val/top1': 25.931972789115648, 'val/top5': 79.23809523809524, 'val/f1_macro': 0.05067065383986265, 'val/f1_micro': 0.2595918367346939, 'val/f1_weighted': 0.26578319422877816, 'val/auc_macro': 0.45524898773426814, 'val/auc_weighted': 0.45483320403191585}
Validation stats for epoch 23: {'val/loss': 2.8916956645939624, 'val/top1': 19.45578231292517, 'val/top5': 78.04081632653062, 'val/f1_macro': 0.04973409519540243, 'val/f1_micro': 0.1945578231292517, 'val/f1_weighted': 0.24148143566132807, 'val/auc_macro': 0.4558363053862398, 'val/auc_weighted': 0.48469076709024167}
Validation stats for epoch 24: {'val/loss': 2.956667366287335, 'val/top1': 25.877551020408163, 'val/top5': 75.83673469387755, 'val/f1_macro': 0.05850045586560785, 'val/f1_micro': 0.2587755102040816, 'val/f1_weighted': 0.29267925314460164, 'val/auc_macro': 0.48916735389565363, 'val/auc_weighted': 0.5537901034361533}
Validation stats for epoch 25: {'val/loss': 3.1619240274234692, 'val/top1': 13.605442176870747, 'val/top5': 78.31292517006803, 'val/f1_macro': 0.04029570325075229, 'val/f1_micro': 0.1360544217687075, 'val/f1_weighted': 0.16171959124194907, 'val/auc_macro': 0.4210427209197619, 'val/auc_weighted': 0.5151864966334857}
Validation stats for epoch 26: {'val/loss': 2.825680712226297, 'val/top1': 24.897959183673468, 'val/top5': 78.91156462585035, 'val/f1_macro': 0.05123797252019623, 'val/f1_micro': 0.24897959183673468, 'val/f1_weighted': 0.2937407347639355, 'val/auc_macro': 0.43854288810720493, 'val/auc_weighted': 0.569361010388783}
Validation stats for epoch 27: {'val/loss': 2.6419861255048893, 'val/top1': 27.238095238095237, 'val/top5': 79.0204081632653, 'val/f1_macro': 0.05513198495297815, 'val/f1_micro': 0.2723809523809524, 'val/f1_weighted': 0.2876702222371074, 'val/auc_macro': 0.52836910272784, 'val/auc_weighted': 0.5256559556973749}
Validation stats for epoch 28: {'val/loss': 3.0224525503560797, 'val/top1': 15.646258503401361, 'val/top5': 83.40136054421768, 'val/f1_macro': 0.03139538296380374, 'val/f1_micro': 0.1564625850340136, 'val/f1_weighted': 0.09363659817084047, 'val/auc_macro': 0.4308682139257234, 'val/auc_weighted': 0.4801824777175088}
Validation stats for epoch 29: {'val/loss': 2.553439791932398, 'val/top1': 37.95918367346939, 'val/top5': 82.2312925170068, 'val/f1_macro': 0.0501411625916783, 'val/f1_micro': 0.3795918367346939, 'val/f1_weighted': 0.2972758277110307, 'val/auc_macro': 0.4985435310534379, 'val/auc_weighted': 0.5309964893056726}
Validation stats for epoch 30: {'val/loss': 3.0726976106604753, 'val/top1': 35.61904761904762, 'val/top5': 78.421768707483, 'val/f1_macro': 0.079783897229716, 'val/f1_micro': 0.35619047619047617, 'val/f1_weighted': 0.39292036934118696, 'val/auc_macro': 0.5013382210456027, 'val/auc_weighted': 0.6080760139548919}
Validation stats for epoch 31: {'val/loss': 2.4255959480960354, 'val/top1': 37.55102040816327, 'val/top5': 81.74149659863946, 'val/f1_macro': 0.056516323573070584, 'val/f1_micro': 0.37551020408163266, 'val/f1_weighted': 0.3172934434527348, 'val/auc_macro': 0.5263382532872994, 'val/auc_weighted': 0.6356818051223712}
Validation stats for epoch 32: {'val/loss': 2.3320605136585884, 'val/top1': 30.53061224489796, 'val/top5': 79.12925170068027, 'val/f1_macro': 0.06305549916682981, 'val/f1_micro': 0.3047619047619048, 'val/f1_weighted': 0.3298146677214649, 'val/auc_macro': 0.4902670553830117, 'val/auc_weighted': 0.5768800000365202}
Validation stats for epoch 33: {'val/loss': 2.1779945093271684, 'val/top1': 42.857142857142854, 'val/top5': 79.40136054421768, 'val/f1_macro': 0.08668870099356475, 'val/f1_micro': 0.42857142857142855, 'val/f1_weighted': 0.42424303107149336, 'val/auc_macro': 0.5222726237482475, 'val/auc_weighted': 0.6858676735465095}
Validation stats for epoch 34: {'val/loss': 2.768748671343537, 'val/top1': 20.35374149659864, 'val/top5': 80.08163265306122, 'val/f1_macro': 0.061885814820577895, 'val/f1_micro': 0.2035374149659864, 'val/f1_weighted': 0.30157203552464285, 'val/auc_macro': 0.4799169241671521, 'val/auc_weighted': 0.6226214226815677}
Validation stats for epoch 35: {'val/loss': 2.1490867687406996, 'val/top1': 33.904761904761905, 'val/top5': 81.52380952380952, 'val/f1_macro': 0.06503780958966779, 'val/f1_micro': 0.33904761904761904, 'val/f1_weighted': 0.33362737263719305, 'val/auc_macro': 0.5670963583648199, 'val/auc_weighted': 0.6823552941474801}
Validation stats for epoch 36: {'val/loss': 2.3649216092687073, 'val/top1': 39.59183673469388, 'val/top5': 78.31292517006803, 'val/f1_macro': 0.07917031511729518, 'val/f1_micro': 0.39591836734693875, 'val/f1_weighted': 0.38948654551364736, 'val/auc_macro': 0.5748348226060516, 'val/auc_weighted': 0.7003603927046282}
Validation stats for epoch 37: {'val/loss': 2.3821210246183435, 'val/top1': 43.564625850340136, 'val/top5': 79.26530612244898, 'val/f1_macro': 0.09287475332155369, 'val/f1_micro': 0.4356462585034014, 'val/f1_weighted': 0.4480277401178691, 'val/auc_macro': 0.5983815808549344, 'val/auc_weighted': 0.7095084553477748}
Validation stats for epoch 38: {'val/loss': 2.6335532758025084, 'val/top1': 24.217687074829932, 'val/top5': 81.60544217687075, 'val/f1_macro': 0.06482502568785294, 'val/f1_micro': 0.24217687074829933, 'val/f1_weighted': 0.29607484274256607, 'val/auc_macro': 0.5007526892549968, 'val/auc_weighted': 0.6047334613987784}
Validation stats for epoch 39: {'val/loss': 2.393987829506803, 'val/top1': 28.653061224489797, 'val/top5': 79.80952380952381, 'val/f1_macro': 0.06667112635544283, 'val/f1_micro': 0.28653061224489795, 'val/f1_weighted': 0.36215935131312704, 'val/auc_macro': 0.6135867695143276, 'val/auc_weighted': 0.6629130235558547}
Validation stats for epoch 40: {'val/loss': 2.6123161430099384, 'val/top1': 34.8843537414966, 'val/top5': 79.37414965986395, 'val/f1_macro': 0.08093117000331597, 'val/f1_micro': 0.348843537414966, 'val/f1_weighted': 0.4144705584613283, 'val/auc_macro': 0.5158169291360447, 'val/auc_weighted': 0.687693326087845}
Validation stats for epoch 41: {'val/loss': 2.939566671150882, 'val/top1': 20.489795918367346, 'val/top5': 82.85714285714286, 'val/f1_macro': 0.06845722423613604, 'val/f1_micro': 0.20489795918367346, 'val/f1_weighted': 0.30417914215825625, 'val/auc_macro': 0.5651652896472023, 'val/auc_weighted': 0.6591710375191219}
Validation stats for epoch 42: {'val/loss': 2.577104766222895, 'val/top1': 25.959183673469386, 'val/top5': 78.25850340136054, 'val/f1_macro': 0.05854101247488261, 'val/f1_micro': 0.2595918367346939, 'val/f1_weighted': 0.3127938972368678, 'val/auc_macro': 0.613772535943537, 'val/auc_weighted': 0.6649400199088874}
Validation stats for epoch 43: {'val/loss': 2.5855056908017113, 'val/top1': 19.80952380952381, 'val/top5': 82.61224489795919, 'val/f1_macro': 0.06243159754459098, 'val/f1_micro': 0.1980952380952381, 'val/f1_weighted': 0.28848779541274444, 'val/auc_macro': 0.5915752047807492, 'val/auc_weighted': 0.6609807768311077}
Validation stats for epoch 44: {'val/loss': 2.60235314194037, 'val/top1': 18.421768707482993, 'val/top5': 82.20408163265306, 'val/f1_macro': 0.04766432463873959, 'val/f1_micro': 0.18421768707482994, 'val/f1_weighted': 0.2558800443485079, 'val/auc_macro': 0.5422202441368454, 'val/auc_weighted': 0.6621640373011137}
Validation stats for epoch 45: {'val/loss': 2.381157907498937, 'val/top1': 20.05442176870748, 'val/top5': 82.85714285714286, 'val/f1_macro': 0.05962844858374005, 'val/f1_micro': 0.20054421768707484, 'val/f1_weighted': 0.2932824627235183, 'val/auc_macro': 0.572706183856918, 'val/auc_weighted': 0.6822551595872223}
Validation stats for epoch 46: {'val/loss': 2.469693200766635, 'val/top1': 25.25170068027211, 'val/top5': 82.72108843537416, 'val/f1_macro': 0.07200661437249836, 'val/f1_micro': 0.2525170068027211, 'val/f1_weighted': 0.3441043881072215, 'val/auc_macro': 0.6100418193790321, 'val/auc_weighted': 0.6867911264254679}
Validation stats for epoch 47: {'val/loss': 2.4619088558274873, 'val/top1': 21.931972789115648, 'val/top5': 82.63945578231292, 'val/f1_macro': 0.05980412659656615, 'val/f1_micro': 0.21931972789115647, 'val/f1_weighted': 0.28936558918079586, 'val/auc_macro': 0.5409956703304158, 'val/auc_weighted': 0.6868477483876521}
Validation stats for epoch 48: {'val/loss': 2.4721613213156357, 'val/top1': 19.836734693877553, 'val/top5': 82.91156462585035, 'val/f1_macro': 0.0565867502502165, 'val/f1_micro': 0.1983673469387755, 'val/f1_weighted': 0.27274580133706655, 'val/auc_macro': 0.6177688077050916, 'val/auc_weighted': 0.6796895697894119}
Validation stats for epoch 49: {'val/loss': 2.4720910478449194, 'val/top1': 21.387755102040817, 'val/top5': 82.36734693877551, 'val/f1_macro': 0.0598329270052151, 'val/f1_micro': 0.21387755102040817, 'val/f1_weighted': 0.28907981433398444, 'val/auc_macro': 0.562669216456445, 'val/auc_weighted': 0.6752160119196069}
=> Evaluating on test set...
Test images: 3675
Test Confusion Matrix:
[[  0   0   0  11   0   0   0   0   3   0   0   0   1   0   1]
 [  0   0   0   6   0   0   0   0   2   0   3   0   4   0   0]
 [  0   1   0  63   0   0   0   0  18   0   1   0   0   0   2]
 [  0   0   0   2   0   1   0   0   0   0   0   0   0   0   0]
 [  0   0   0   2   0   0   0   0   1   0   0   0   0   0   0]
 [  0  31   3 387   0 103   0   0 128   0  17   0 111   0   8]
 [  0   0   0   1   0   0   0   0   2   0   1   0   0   0   0]
 [  0   0   0   4   0   0   0   0   1   0   0   0   0   0   0]
 [  0   1   3 260   0  19   0   0  65   0   4   0   2   0   4]
 [  0   0   0   2   0   1   0   0   6   0   0   0   0   0   0]
 [  0   3   2 443   0  52   0   0 119   0  17   0   8   0   9]
 [  0   0   0  13   0   1   0   0   5   0   0   0   3   0   0]
 [  0   2   4 852   0  49   0   0 211   0  47   0 505   0  27]
 [  0   0   0   2   0   0   0   0   1   0   0   0   0   0   0]
 [  0   0   0   9   0   1   0   0   4   0   0   0   0   0   0]]
Basophil [0]: 0.0
Erythroblast [1]: 0.0
Eosinophil [2]: 0.0
Smudge cell [3]: 66.66666412353516
Atypical Lymphocyte [4]: 0.0
Typical Lymphocyte [5]: 13.071065902709961
Metamyelocyte [6]: 0.0
Monoblast [7]: 0.0
Monocyte [8]: 18.15642547607422
Myelocyte [9]: 0.0
Myeloblast [10]: 2.6033689975738525
Band Neutrophil [11]: 0.0
Segmented Neutrophil [12]: 29.817325592041016
Promyelocyte Bilobed [13]: 0.0
Promyelocyte [14]: 0.0
Test stats: {'test/loss': 2.5416291113613414, 'test/top1': 18.829931972789115, 'test/top5': 81.55102040816327, 'test/f1_macro': 0.05497606115112843, 'test/f1_micro': 0.18829931972789116, 'test/f1_weighted': 0.26543626698834866, 'test/auc_macro': 0.5345500344016316, 'test/auc_weighted': 0.647529983970415}
Fin del script.
